---
import Button from "@components/Button/Button.astro";

const WHATSAPP_NUMBER = "+542901449739";
---

<form id="contact-form" name="contact form" class="flex h-full flex-col justify-between gap-4">
	<input type="hidden" name="form-name" value="contact" />
	<div>
		<label for="contact-name" class="font-heading-1 text-lg uppercase">Nombre</label>
		<input type="text" class="form__input" name="name" id="contact-name" placeholder="" required />
	</div>
	<div>
		<label for="checkin-date" class="font-heading-1 text-lg uppercase">Fecha de llegada</label>
		<input
			type="date"
			class="form__input"
			name="checkin-date"
			id="checkin-date"
			placeholder=""
			required
		/>
	</div>
	<div>
		<label for="checkout-date" class="font-heading-1 text-lg uppercase">Fecha de partida</label>
		<input
			type="date"
			class="form__input"
			name="checkout-date"
			id="checkout-date"
			placeholder=""
			required
		/>
	</div>
	<div>
		<label for="contact-message" class="font-heading-1 text-lg uppercase">Mensaje</label>
		<textarea
			name="message"
			class="form__input"
			id="contact-message"
			rows="6"
			placeholder=""></textarea>
	</div>
	<div class="flex">
		<Button variant="primary" type="submit" class="w-full px-10 md:w-fit">Consultar</Button>
	</div>
</form>

<script define:vars={{ WHATSAPP_NUMBER }}>
	function initContactForm() {
		const form = document.getElementById("contact-form");
		if (!form) return;

		form.addEventListener("submit", (e) => {
			e.preventDefault();

			const nameInput = document.getElementById("contact-name");
			const checkinInput = document.getElementById("checkin-date");
			const checkoutInput = document.getElementById("checkout-date");
			const messageInput = document.getElementById("contact-message");

			const name = nameInput?.value?.trim() || "";
			const checkin = checkinInput?.value || "";
			const checkout = checkoutInput?.value || "";
			const message = messageInput?.value?.trim() || "";

			const formatDate = (dateStr) => {
				if (!dateStr) return "";
				const [year, month, day] = dateStr.split("-");
				return `${day}/${month}/${year}`;
			};

			let text = `Hola, estoy buscando alojamiento en Ituzaing√≥\n\n`;
			text += `*Nombre:* ${name}\n`;
			text += `*Check-in:* ${formatDate(checkin)}\n`;
			text += `*Check-out:* ${formatDate(checkout)}`;

			if (message) {
				text += `\n\n*Mensaje:*\n${message}`;
			}

			const encodedText = encodeURIComponent(text);
			const whatsappUrl = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodedText}`;

			window.open(whatsappUrl, "_blank");
		});
	}

	initContactForm();
	document.addEventListener("astro:after-swap", initContactForm);
</script>
